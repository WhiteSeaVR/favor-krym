var filterTypeNote,filterTypeNoteHoliday,churchTitleDat,filterChurch,$noteInfoInOrderRecurrent,settings={selectorNewsList:".news-project-list",selectorNewsItem:".news-project-block",selectorCsrfToken:'meta[name="csrf-token"]',selectorLoginProfile:".drop-window-enter",selectorLoginProfileForm:"#login-form",selectorLoginProfileButton:"#login-form .button-form-login",selectorLoginProfileMob:".login-block-mobile",selectorLoginProfileFormMob:"#login-form-mob",selectorLoginProfileButtonMob:"#login-form-mob .button-form-login",selectorErrorBlock:".error-input",selectorErrorInput:".error-input input, .error-input textarea, input.error-input",selectorErrorMessage:".error",selectorInputContner:".input-container",selectorLoginForComment:".comment-auto",selectorFormClear:".form-clear",selectorAddCandleInCart:".add-candle-in-cart",selectorModalInfo:"#modal-info",selectorModalInfoTitle:"#modal-info .modal-title",selectorModalInfoMessage:"#modal-info .free-note-area",selectorModalAddToCart:"#modal-add-to-cart",selectorModalAddToCartTitle:"#modal-add-to-cart .modal-title",selectorModalAddToCartMessage:"#modal-add-to-cart .free-note-area",selectorModal:".jquery-modal",selectorCloseModal:".close-modal",selectorBlockSendNote:"#block-send-note",selectorFilterHoliday:"#filter-holiday",selectorShowFilterHolidayMob:"#show-filter-holiday-mob",selectorBlockFilterHolidayMob:"#block-filter-holiday-mob",selectorFilterChurch:"#filter-church",selectorShowFilterChurchMob:"#show-filter-church-mob",selectorBlockFilterChurchMob:"#block-filter-church-mob",selectorBlockOptionInfo:".block-option-info",selectorOptionInfo:".option-info",selectorMenuSpecial:"#menu-special",selectorMenuSpecialItem:".accordion-menu-area-links",selectorMenuSpecialShowSubmenu:".show-submenu",selectorMenuSpecialSubmenu:".accordion-menu-submenu",selectorSelect:".input-select",selectorSelectInput:".input-select .select",selectorSelectOption:".input-select .options-result span",selectorFilterToggle:".pc-catalog-filter-btn",selectorFilter:".content-filter-block",selectorUtmTags:"#utm-tags",selectorFormOrder:"#form-order",selectorPopupTip:".popup-tip",selectorPopupTipClose:".popup-tip .pop-up-close",selectorFilterChurchItem:".filter-church-list .filter-item",selectorFilterChurchItemImg:".filter-icon img",selectorFilterChurchItemTitle:".filter-name",selectorFilterChurchItemText:".data-tip",selectorChurchShowTip:".filter-church-list .faq",selectorChurchBlockTip:"#church-tip",selectorBlockTipIcon:".content-icon img",selectorBlockTipTitle:".content-title",selectorBlockTipText:".content-text",selectorMainTypeNoteBlockTip:"#main-type-note-tip",selectorFilterTypeNoteMainShowTip:".content-filter-block .faq-qw, #block-filter-church-mob .faq-qw, #block-filter-holiday-mob .faq-qw",selectorFilterMainTypeNoteItem:".content-filter-block .choice-btn",selectorFilterRow:".choice-btn",selectorFilterMainTypeNoteItemTitle:".data-title",selectorFilterMainTypeNoteItemText:".data-tip",selectorBlockFreeNote:"#block-free-note",selectorFormFreeNote:"#f-free-note",selectorModalFreeNote:"#modal-free-note",selectorFreeNoteText:".free-note-content",selectorBlockFreeNoteFamily:"#block-free-note-family",selectorFormFreeNoteFamily:"#f-free-note-family",selectorFreeNoteFamilyTypeNote:".free-note-family-type-note",selectorModalFreeNoteFamilyShare:"#modal-free-note-family-share",selectorShowModalFreeNoteFamilyThanks:"#modal-free-note-family-share .btn-modal-other",selectorModalFreeNoteFamilyThanks:"#modal-free-note-family-thanks",selectorBlockLk:"#block-lk",selectorBlockLogin:".profile-enter-cabinet",selectorBlockLoginMob:".show_mobile_login",selectorBlockFilterCandle:"#block-filter-candle",selectorShowFilterCandleMob:"#show-filter-candle-mob",selectorBlockFilterCandleMob:"#block-filter-candle-mob",selectorBlockSortCandle:"#block-sort-candle",selectorLeftMobileMenuArea:".left-mobile-menu-area",selectorFormSubscribe:".mail-form",selectorFormSubscribeTop:".newsletter__form",selectorHolidayFullText:".full-text",selectorHolidayReadMore:".read-all",selectorHolidayTextReadMore:".text-read-all",selectorNavigationLink:".navigation-link",classErrorBlock:"error-input",classShowModal:"blocker",classActive:"_active",classOpen:"_open",classShow:"_show",classRest:"_rest",classFilterSelect:"_filter-select",classDarkActive:"btn-dark-yellow-green"},patternEmail=/^[A-Z0-9._%+-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/i,cookieList=function(e){var t=$.cookie(e),o=t?t.split(/,/):new Array;return{add:function(t){o.includes(t)||(o.push(t),$.cookie(e,o.join(",")))},remove:function(t){indx=o.indexOf(t),-1!=indx&&o.splice(indx,1),$.cookie(e,o.join(","))},clear:function(){o=null,$.cookie(e,null)},items:function(){return o}}};function includeJS(e){var t=document.createElement("script");t.src=e,t.setAttribute("defer",""),document.getElementsByTagName("head")[0].appendChild(t)}function implode(e,t){return t instanceof Array?t.join(e):t}function setUtmTags(){$(settings.selectorUtmTags).length&&"undefined"!=typeof sbjs&&($("#utm_type").val(sbjs.get.current.typ),$("#utm_source").val(sbjs.get.current.src),$("#utm_medium").val(sbjs.get.current.mdm),$("#utm_campaign").val(sbjs.get.current.cmp),$("#utm_term").val(sbjs.get.current.trm),$("#utm_content").val(sbjs.get.current.cnt))}function showModalInfo(e,t){$(settings.selectorModalInfoTitle).html(e),$(settings.selectorModalInfoMessage).html(t),$(settings.selectorModalInfo).modal({fadeDuration:250})}function showModalAddToCart(e,t){$(settings.selectorModalAddToCartTitle).html(e),$(settings.selectorModalAddToCartMessage).html(t),$(settings.selectorModalAddToCart).modal({fadeDuration:250})}function showLogin(){$(".menu-content-login").css({display:"block"}),$(settings.selectorLeftMobileMenuArea).addClass(settings.classOpen),$(settings.selectorBlockLogin).trigger("click")}function validEmail(e){var t,o=!1,n=e.parents(settings.selectorInputContner).find(settings.selectorErrorMessage);return""!=e.val()?0==e.val().search(patternEmail)?o=!0:t="Значение «Email» не является правильным email адресом.":t="Необходимо заполнить «Email».",o?(n.text("").hide(),e.parents(settings.selectorInputContner).removeClass(settings.classErrorBlock)):(n.text(t).show(),e.parents(settings.selectorInputContner).addClass(settings.classErrorBlock)),o}function healthNamesObject(){var e={};this.addOriginalName=function(t,o){""!==t.trim()&&(e[o]={name:t,status:"original"})},this.isEmpty=function(){return 0===Object.entries(e).length},this.hasStatusOriginList=function(){var t=!1;for(var o in e)if("original"==e[o].status){t=!0;break}return t},this.getCountStatusOrigin=function(){var t=0;for(var o in e)"original"==e[o].status&&t++;return t},this.hasStatusItem=function(t,o){return!this.isEmpty()&&void 0!==e[t]&&e[t].status==o},this.setStatusRemoveList=function(){for(var t in e)"original"==e[t].status&&(e[t].status="remove")},this.setStatusItem=function(t,o){this.isEmpty()||void 0===e[t]||(e[t].status=o)},this.isNameChange=function(t,o){return!this.isEmpty()&&void 0!==e[t]&&e[t].name!==o}}function blockSendNote(e){var t,o={selectorFormSendNote:e+" form",selectorFormSendNoteTitle:e+" form .title",selectorOptionChurchSection:e+" .option-church-section",selectorFormSendErrorName:e+" .note-form-error-name",selectorFormSendErrorGeneral:".note-form-error-general",selectorBlockTypeNote:".select-type-1",selectorBlockInputTypeNote:".input-select",selectorSelectTypeNote:".select",selectorOptionTypeNote:".select-type-1 .options-result span",selectorInputTypeNote:".select span",selectorSettOptionChurch:".sett-option-church",selectorSettInputChurch:".sett-input-church",selectorSettChurchTitle:".sett-select-church .option-title",selectorSettSelectTypeNoteType:".sett-select-type-note-type",selectorSettOptionTypeNoteType:".sett-option-type-note-type",selectorSettSelectMainTypeNote:".sett-select-main-type-note",selectorSettOptionsMainTypeNote:".sett-select-main-type-note .options",selectorSettOptionMainTypeNote:".sett-option-main-type-note",selectorSettInputMainTypeNote:".sett-input-main-type-note",selectorSettSelectTypeNoteDuration:".sett-select-type-note-duration",selectorSettOptionsTypeNoteDuration:".sett-select-type-note-duration .options",selectorSettOptionTypeNoteDuration:".sett-option-type-note-duration",selectorSettInputTypeNoteDuration:".sett-input-type-note-duration",selectorSettSelectTypeNotePostfix:".sett-select-type-note-postfix",selectorSettOptionsTypeNotePostfix:".sett-select-type-note-postfix .options",selectorSettOptionTypeNotePostfix:".sett-option-type-note-postfix",selectorSettInputTypeNotePostfix:".sett-input-type-note-postfix",selectorSelectNoteItem:e+" .select-note-item",selectorSelectNoteList:e+" .select-note-list",selectorItemCandle:".item-candle",selectorItemCandlePrice:".item-candle-price",selectorItemCandleCount:".item-candle-count",selectorItemCandleCountPlus:".item-candle-count-plus",selectorItemCandleCountMinus:".item-candle-count-minus",selectorBlockNameInput:".block-name-input",selectorItemNameInput:".item-name-input",selectorButtonSendNote:".button-send-note",selectorFilterChurchItem:".filter-church-item",selectorFilterChurchNoteItem:".filter-church-note-item",selectorFilterChurchSelectAll:".filter-church-select-all",selectorFullCost:".full-cost",selectorHasEditUrl:".has-edit-url",selectorButtonClearNames:".button-clear-names",selectorInputClearName:".input-clear",selectorCartTypeNoteId:'input[name="cart_type_note_id"]'},n=$(e).find(o.selectorSettInputChurch).attr("data-church-id"),s=$(e).find(o.selectorSettOptionTypeNoteType+"."+settings.classActive).attr("data-type-note"),r=$(e).find(o.selectorSettInputMainTypeNote).attr("data-main-type-note-id"),a=$(e).find(o.selectorSettInputTypeNoteDuration).attr("data-type-note-duration-id"),i=$(e).find(o.selectorSettInputTypeNotePostfix).attr("data-type-note-postfix-id"),l=[];function c(){$(e).find(o.selectorItemNameInput).val("")}function d(){var t=0;return $(e).find(o.selectorItemNameInput).each((function(){""!==$(this).val().trim()&&t++})),t}function u(){var t=0,n=d(),s=0,r=0,a=0,i=0;$(o.selectorSelectNoteItem).each((function(){price=$(this).attr("data-price"),t+=parseInt(price)})),i=t*n,$(e).find(o.selectorItemCandle+":visible").each((function(){var e=$(this).find(o.selectorItemCandleCount);s=Number(e.attr("data-price")),r=Number(e.html()),a+=s*r})),i+=a,$(e).find(o.selectorFullCost).html(i)}this.setNames=function(){if(void 0===t&&0==d()&&!$(o.selectorFormSendNote).hasClass(settings.classRest)&&1==$.cookie("abFillingNames")&&null!=$.cookie("names_health"))try{var e=JSON.parse(decodeURI($.cookie("names_health"))),n=0;for(var s in t=new healthNamesObject,e)e[s]=e[s].replace("+"," "),$(o.selectorItemNameInput+"[data-index="+n+"]").val(e[s]),n++,t.addOriginalName(e[s],s);t.isEmpty()||(window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Details",eventAction:"FieldsDynamicFill",NoteType:$(o.selectorFormSendNote).hasClass(settings.classRest)?"За упокой":"За здравие"})),u()}catch(e){}},u(),$(e).on("click",o.selectorOptionTypeNote,(function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(o.selectorBlockTypeNote);t.find(o.selectorInputTypeNote).html($(this).html()),t.find(".input-select").hasClass(settings.classOpen)&&(t.find(".input-select").removeClass(settings.classOpen),t.find(".options").slideToggle())})),$(o.selectorOptionChurchSection).on("click",(function(t){!function(t){t.hasClass(settings.classActive)||("church"==t.attr("data-church-section")?$(e).find(o.selectorSettChurchTitle).html("Куда будет отправлена записка"):$(e).find(o.selectorSettChurchTitle).html("Молитвенное прошение"),$(o.selectorOptionChurchSection).removeClass(settings.classActive),t.addClass(settings.classActive),$(e).find(o.selectorSettOptionChurch).hide().removeClass(settings.classShow),$(e).find(o.selectorSettOptionChurch+"[data-church-section="+t.attr("data-church-section")+"]").show().addClass(settings.classShow),$(e).find(o.selectorSettOptionChurch+"."+settings.classShow).first().trigger("click"))}($(this))})),$(o.selectorSettOptionChurch).on("click",(function(t){!function(t){t.attr("data-church-id")!=n&&(n=t.attr("data-church-id"),churchTitleDat=t.attr("data-church-title-dat"),$.ajax({url:"/church/get_filter_type_note",data:"church_id="+n,method:"post",async:!1,success:function(t){var n=JSON.parse(t);if(!$.isEmptyObject(n.filterTypeNote)){for(var r in filterTypeNote=n.filterTypeNote,$(e).find(o.selectorSettOptionTypeNoteType).each((function(e){var t=$(this).attr("data-type-note");null==filterTypeNote[t]?$(this).hide():$(this).show()})),null==filterTypeNote[s]&&(s=Object.keys(filterTypeNote)[0]),$(e).find(o.selectorSettOptionMainTypeNote).remove(),$(e).find(o.selectorSettSelectMainTypeNote+" "+settings.selectorOptionInfo).remove(),n.mainTypeNoteList){var a=n.mainTypeNoteList[r];$(e).find(o.selectorSettOptionsMainTypeNote).append('<span class="sett-option-main-type-note" data-main-type-note-id="'+a.id+'">'+a.title+"</span>"),$(e).find(o.selectorSettSelectMainTypeNote+" "+settings.selectorBlockOptionInfo).append('<div class="option-info" data-main-type-note-id="'+a.id+'">'+a.short_desc+"</div>")}for(var r in $(e).find(o.selectorSettOptionTypeNoteDuration).remove(),n.typeNoteDurationList){var i=n.typeNoteDurationList[r];$(e).find(o.selectorSettOptionsTypeNoteDuration).append('<span class="sett-option-type-note-duration" data-type-note-duration-id="'+i.id+'">'+i.title+"</span>")}for(var r in $(e).find(o.selectorSettOptionTypeNotePostfix).remove(),n.typeNotePostfixList){var l=n.typeNotePostfixList[r];$(e).find(o.selectorSettOptionsTypeNotePostfix).append('<span class="sett-option-type-note-postfix" data-type-note-postfix-id="'+l.id+'">'+l.title+"</span>")}$(e).find(o.selectorSettOptionTypeNoteType+'[data-type-note="'+s+'"]').trigger("click")}}}))}($(this))})),$(o.selectorSettOptionTypeNoteType).on("click",(function(n){$(this).hasClass(settings.classRest)&&!$(this).hasClass(settings.classActive)&&(t=void 0,l=[],$(e).find(o.selectorItemNameInput).each((function(e){""!==$(this).val().trim()&&l.push($(this).val())})),c()),$(this).hasClass(settings.classRest)||$(this).hasClass(settings.classActive)||function(){c();var e=0;for(var t in l)$(o.selectorItemNameInput+"[data-index="+e+"]").val(l[t]),e++}(),function(t){for(var n in"rest"==(s=t.attr("data-type-note"))?$(o.selectorFormSendNote).addClass(settings.classRest):$(o.selectorFormSendNote).removeClass(settings.classRest),$(e).find(o.selectorItemCandle).hide(),filterTypeNote[s].candle){var a=filterTypeNote[s].candle[n],i=$(e).find(o.selectorItemCandle+'[data-size="'+n+'"]');i.show(),i.find(o.selectorItemCandlePrice).html(a.price+" Р"),i.find(o.selectorItemCandleCount).attr("data-price",a.price),i.find(o.selectorItemCandleCount).attr("data-id",a.id)}for(var l in $(e).find(o.selectorSettOptionTypeNoteType).removeClass(settings.classActive),t.addClass(settings.classActive),$(e).find(o.selectorSettSelectTypeNoteType).find(settings.selectorOptionInfo).hide(),$(e).find(o.selectorSettSelectTypeNoteType).find(settings.selectorOptionInfo+'[data-type-note="'+s+'"]').show(),$(e).find(o.selectorSettOptionMainTypeNote).hide().removeClass(settings.classShow),filterTypeNote[s].main_type_note)$(e).find(o.selectorSettOptionMainTypeNote+'[data-main-type-note-id="'+l+'"]').show().addClass(settings.classShow);$(e).find(o.selectorSettOptionMainTypeNote+'[data-main-type-note-id="'+r+'"]').hasClass(settings.classShow)?$(e).find(o.selectorSettOptionMainTypeNote+'[data-main-type-note-id="'+r+'"]').trigger("click"):$(e).find(o.selectorSettOptionMainTypeNote+"."+settings.classShow).first().trigger("click")}($(this))})),$(e).on("click",o.selectorSettOptionMainTypeNote,(function(t){!function(t){for(var n in r=t.attr("data-main-type-note-id"),$(e).find(o.selectorSettInputMainTypeNote).attr("data-main-type-note-id",r),$(e).find(o.selectorSettOptionTypeNoteDuration).hide().removeClass(settings.classShow),$(e).find(o.selectorSettSelectMainTypeNote).find(settings.selectorOptionInfo).hide(),$(e).find(o.selectorSettSelectMainTypeNote).find(settings.selectorOptionInfo+'[data-main-type-note-id="'+r+'"]').show(),filterTypeNote[s].main_type_note[r].duration)$(e).find(o.selectorSettOptionTypeNoteDuration+'[data-type-note-duration-id="'+n+'"]').show().addClass(settings.classShow);$(e).find(o.selectorSettOptionTypeNoteDuration+'[data-type-note-duration-id="'+a+'"]').hasClass(settings.classShow)?$(e).find(o.selectorSettOptionTypeNoteDuration+'[data-type-note-duration-id="'+a+'"]').trigger("click"):$(e).find(o.selectorSettOptionTypeNoteDuration+"."+settings.classShow).first().trigger("click")}($(this))})),$(e).on("click",o.selectorSettOptionTypeNoteDuration,(function(t){!function(t){for(var n in a=t.attr("data-type-note-duration-id"),$(e).find(o.selectorSettInputTypeNoteDuration).attr("data-type-note-duration-id",a),$(e).find(o.selectorSettOptionTypeNotePostfix).hide().removeClass(settings.classShow),$(e).find(o.selectorSettSelectTypeNoteDuration).find(settings.selectorOptionInfo+'[data-type-note-duration-id="'+a+'"]').show(),filterTypeNote[s].main_type_note[r].duration[a].postfix)$(e).find(o.selectorSettOptionTypeNotePostfix+'[data-type-note-postfix-id="'+n+'"]').show().addClass(settings.classShow);$(e).find(o.selectorSettOptionTypeNotePostfix+'[data-type-note-postfix-id="'+i+'"]').hasClass(settings.classShow)?$(e).find(o.selectorSettOptionTypeNotePostfix+'[data-type-note-postfix-id="'+i+'"]').trigger("click"):$(e).find(o.selectorSettOptionTypeNotePostfix+"."+settings.classShow).first().trigger("click")}($(this))})),$(e).on("click",o.selectorSettOptionTypeNotePostfix,(function(t){!function(t){0==(i=t.attr("data-type-note-postfix-id"))&&1==$(e).find(o.selectorSettOptionTypeNotePostfix+"."+settings.classShow).length?$(e).find(o.selectorSettSelectTypeNotePostfix).hide():$(e).find(o.selectorSettSelectTypeNotePostfix).show();var n=filterTypeNote[s].main_type_note[r].duration[a].postfix[i].note;$(e).find(o.selectorSettInputTypeNotePostfix).attr("data-type-note-postfix-id",i),$(o.selectorSelectNoteItem).val(n.id).attr("data-price",n.price).attr("name","NoteIds["+n.id+"]");var l=$(e).find(o.selectorSettInputMainTypeNote).html(),c=$(e).find(o.selectorSettInputTypeNoteDuration).html(),d=0==i?"":$(e).find(o.selectorSettInputTypeNotePostfix).html(),p=$(e).find(o.selectorSettOptionTypeNoteType+"."+settings.classActive).html();$(o.selectorFormSendNoteTitle).html(l+"<br>"+p+", на "+c+d+"<br>"+churchTitleDat),u()}($(this))})),$(e).on("click",o.selectorItemNameInput,(function(){var t=$(this).attr("data-index");t==$(e).find(o.selectorItemNameInput).length-1&&(t++,$(e).find(o.selectorBlockNameInput).append('<div class="input-container"><input class="item-name-input" type="text" placeholder="Имя в Родительном падеже"  name="Names['+t+']" maxlength="15" data-index='+t+'><div class="input-clear"></div></div>'))})),$(e).on("focusout",o.selectorItemNameInput,(function(){u()})),$(o.selectorItemCandleCountPlus).on("click",(function(e){e.preventDefault(),pGa.click($(this).parents(o.selectorItemCandle));var t=$(this).parents(o.selectorItemCandle).find(o.selectorItemCandleCount),n=Number(t.html())+1;t.html(n),u()})),$(o.selectorItemCandleCountMinus).on("click",(function(e){e.preventDefault();var t=$(this).parents(o.selectorItemCandle).find(o.selectorItemCandleCount),n=Number(t.html())-1;n>=0&&t.html(n),u()})),$(o.selectorFilterChurchSelectAll).on("click",(function(e){e.preventDefault(),$(o.selectorFilterChurchItem).not("."+settings.classFilterSelect).each((function(){$(this).find(o.selectorFilterChurchNoteItem).trigger("click")}))})),$(o.selectorFilterChurchNoteItem).on("click",(function(e){e.preventDefault();var t=Number($(this).attr("data-id")),n=Number($(this).attr("data-price")),s=$(this).parents(o.selectorFilterChurchItem);s.hasClass(settings.classFilterSelect)?$(o.selectorFilterChurchItem+"."+settings.classFilterSelect).length>1&&(s.removeClass(settings.classFilterSelect),$(o.selectorSelectNoteItem+"[value="+t+"]").remove()):(s.addClass(settings.classFilterSelect),pGa.click($(this)),$(o.selectorSelectNoteList).append('<input type="hidden" class="select-note-item" name="NoteIds['+t+']" value="'+t+'" data-price="'+n+'">')),u()})),$(e).on("click",o.selectorButtonSendNote,(function(n){n.preventDefault();var s=$(o.selectorFormSendNote),r=!1;if(0==d()&&($(o.selectorFormSendErrorName).html("Необходимо заполнить имена."),r=!0),0==$(o.selectorSelectNoteItem).length&&($(o.selectorFormSendErrorGeneral).html("Не выбрана записка."),r=!0),!r){var a,i=["target="+$(this).val()];$(e).find(o.selectorItemCandle+":visible").each((function(){var e=$(this).find(o.selectorItemCandleCount);e.html()>0&&i.push("CandlesCount["+e.attr("data-id")+"]="+e.html())}));var l=document.location.pathname;$(e).find(o.selectorHasEditUrl).length>0&&i.push("edit_url="+l),$(e).find(o.selectorItemNameInput).each((function(){var e=$(this).val(),o=$(this).attr("data-index");void 0!==t&&t.hasStatusItem(o,"original")&&t.isNameChange(o,e)&&(window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Details",eventAction:"FieldsEdit"}),t.setStatusItem(o,"change"))}));var c=void 0!==t?t.getCountStatusOrigin():-1;i.push("names_autofill_count="+c),a=implode("&",i),$.ajax({url:"/church/add_note",data:s.serialize()+"&"+a,method:"post",async:!1,success:function(e){var n=JSON.parse(e);if("ERROR"==n.result)for(var s in n.errors)alert(n.errors[s]);if("OK"==n.result){if(null!=n.gtm&&null!=n.gtm.notes_add_cart){window.dataLayer=window.dataLayer||[];var r={ecommerce:{currencyCode:"RUB",add:{products:n.gtm.notes_add_cart}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Adding a Product to a Shopping Cart","gtm-ee-event-non-interaction":"False"};void 0!==t&&c>=0&&(r.TotalNamesCount=d(),r.DynamicNamesCount=c,t=void 0),dataLayer.push(r)}null!=n.gtm&&null!=n.gtm.notes_remove_cart&&(window.dataLayer=window.dataLayer||[],dataLayer.push({ecommerce:{currencyCode:"RUB",remove:{products:n.gtm.notes_remove_cart}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Removing a Product from a Shopping Cart","gtm-ee-event-non-interaction":"False"})),null!=n.gtm&&null!=n.gtm.ads_value&&null!=n.gtm.ads_items&&dataLayer.push({event:"add_to_cart",value:n.gtm.ads_value,items:n.gtm.ads_items}),"/cart"==n.href?["/christmas","/noviygod"].includes(l)?window.location.href=window.location.protocol+"//"+window.location.hostname+n.href:d()>2?window.location.href=window.location.protocol+"//"+window.location.hostname+"/cart":($(o.selectorCartTypeNoteId).val(n.cart_type_note_id),showModalAddToCart(n.popup_title,"В записке обычно указывают всех наиболее близких и родных людей, у вас есть возможность внести их имена.")):window.location.href=window.location.protocol+"//"+window.location.hostname+n.href}}})}})),$(e).on("click",o.selectorButtonClearNames,(function(e){e.preventDefault(),c(),u(),void 0!==t&&t.hasStatusOriginList()&&(window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Details",eventAction:"FieldsCleanButtonClick"}),t.setStatusRemoveList())})),$(e).on("keydown",o.selectorItemNameInput,(function(e){if(13==e.keyCode){e.preventDefault();var t=$(this).parents(settings.selectorInputContner).next();return t.hasClass("input-container")&&t.find(o.selectorItemNameInput).focus().trigger("click"),!1}})),$(e).on("input",o.selectorItemNameInput,(function(e){var o=$(e.target).val(),n=$(this).attr("data-index");void 0!==t&&(t.hasStatusItem(n,"original")||t.hasStatusItem(n,"change"))&&""==o&&(window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Details",eventAction:"FieldsDeleteManual"}),t.setStatusItem(n,"remove"))})),$(e).on("click",o.selectorInputClearName,(function(e){e.preventDefault();var n=$(this).parents(settings.selectorInputContner).find(o.selectorItemNameInput);n.val(""),u();var s=n.attr("data-index");void 0!==t&&t.hasStatusItem(s,"original")&&(window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Details",eventAction:"FieldsDeleteButtonClick"}),t.setStatusItem(s,"remove"))})),$(settings.selectorModalAddToCart).on("modal:open",(function(e){var t=$(settings.selectorModalAddToCart),o=t.position().top+t.height(),n=t.position().left+t.width();(0==o||0==n||o>$(window).height()||n>$(window).width())&&(window.location.href=window.location.protocol+"//"+window.location.hostname+"/cart")}))}function filterHoliday(e){var t=".sett-option-church",o=".sett-input-church",n=".sett-option-type-note-type",s=".sett-option-main-type-note",r=".button-send-note",a=$(e).find(o).attr("data-church-id"),i=$(e).find(n+"."+settings.classActive).attr("data-type-note"),l=$(e).find(s+"."+settings.classActive).attr("data-main-type-note-id");$(e).on("click",t,(function(t){!function(t){t.attr("data-church-id")!=a&&(a=t.attr("data-church-id"),$.ajax({url:"/church/get_filter_type_note",data:"church_id="+a,method:"post",async:!1,success:function(t){var o=JSON.parse(t);$.isEmptyObject(o.filterTypeNote)||(filterTypeNoteHoliday=o.filterTypeNote,$(e).find(n).each((function(e){var t=$(this).attr("data-type-note");null==filterTypeNoteHoliday[t]?$(this).hide():$(this).show()})),null==filterTypeNoteHoliday[i]&&(i=Object.keys(filterTypeNoteHoliday)[0]),$(e).find(n+'[data-type-note="'+i+'"]').trigger("click"))}}))}($(this))})),$(e).on("click",n,(function(t){!function(t){for(var o in i=t.attr("data-type-note"),$(e).find(n).removeClass(settings.classActive).removeClass(settings.classDarkActive),t.addClass(settings.classActive).addClass(settings.classDarkActive),$(e).find(s).hide(),filterTypeNoteHoliday[i].main_type_note)$(e).find(s+'[data-main-type-note-id="'+o+'"]').show().addClass(settings.classShow);$(e).find(s+'[data-main-type-note-id="'+l+'"]').hasClass(settings.classShow)?$(e).find(s+'[data-main-type-note-id="'+l+'"]').trigger("click"):$(e).find(s+"."+settings.classShow).first().trigger("click")}($(this))})),$(e).on("click",s,(function(t){!function(t){l=t.attr("data-main-type-note-id"),$(e).find(s).removeClass(settings.classActive).removeClass(settings.classDarkActive).addClass("btn-border"),t.addClass(settings.classActive).addClass(settings.classDarkActive).removeClass("btn-border");var o=filterTypeNoteHoliday[i].main_type_note[l].duration,n=o[Object.keys(o)[0]].postfix,a=n[Object.keys(n)[0]].note;$(e).find(r).attr("href",a.href)}($(this))}))}function filterChurch(e){var t=".sett-option-type-note-type",o=".sett-option-main-type-note",n=".button-send-filter",s=$(e).find(t+"."+settings.classActive).attr("data-type-note"),r=$(e).find(o+"."+settings.classActive).attr("data-main-type-note-id");$(e).on("click",t,(function(a){!function(a){for(var i in s=a.attr("data-type-note"),$(e).find(t).removeClass(settings.classActive).removeClass(settings.classDarkActive),a.addClass(settings.classActive).addClass(settings.classDarkActive),$(e).find(o).hide(),filterTypeNoteChurch[s].main_type_note)$(e).find(o+'[data-main-type-note-id="'+i+'"]').show().addClass(settings.classShow);$(e).find(o+'[data-main-type-note-id="'+r+'"]').hasClass(settings.classShow)?$(e).find(o+'[data-main-type-note-id="'+r+'"]').trigger("click"):$(e).find(n).attr("href",document.location.pathname+"?filter[type_note_type]="+s)}($(this))})),$(e).on("click",o,(function(t){!function(t){var a,i=[],l=document.location.pathname;r=t.attr("data-main-type-note-id"),$(e).find(o).removeClass(settings.classActive).removeClass(settings.classDarkActive).addClass("btn-border"),t.addClass(settings.classActive).addClass(settings.classDarkActive).removeClass("btn-border"),null!=s&&i.push("filter[type_note_type]="+s),null!=r&&i.push("filter[main_type_note_id]="+r),a=implode("&",i),i.length>0&&(l=l+"?"+a),$(e).find(n).attr("href",l)}($(this))}))}function filterCandle(e){var t="#block-church-section",o="#block-church-section button",n="#block-type",s="#block-type button",r="#block-size",a="#block-size button",i="#button-send-filter",l=".sett-option-sort";$(e).on("click",t+" button",(function(t){$(e+" "+o).removeClass(settings.classDarkActive).addClass("btn-border"),$(this).addClass(settings.classDarkActive).removeClass("btn-border")})),$(e).on("click",n+" button",(function(t){$(e+" "+s).removeClass(settings.classDarkActive).addClass("btn-border"),$(this).addClass(settings.classDarkActive).removeClass("btn-border")})),$(e).on("click",r+" button",(function(t){$(e+" "+a).removeClass(settings.classDarkActive).removeClass(settings.classActive),$(this).addClass(settings.classDarkActive).addClass(settings.classActive)})),$(e).on("click",i,(function(t){t.preventDefault();var o=[];$(e+"  button."+settings.classDarkActive).each((function(e){o.push($(this).attr("data-name")+"="+$(this).attr("data-val"))})),o.push($(settings.selectorBlockSortCandle).attr("data-name")+"="+$(settings.selectorBlockSortCandle).attr("data-val")),window.location.href="/candle?"+implode("&",o)})),$(settings.selectorBlockSortCandle).on("click",l,(function(e){var t=[];$(settings.selectorBlockFilterCandle+" button."+settings.classDarkActive).each((function(e){t.push($(this).attr("data-name")+"="+$(this).attr("data-val"))})),t.push($(settings.selectorBlockSortCandle).attr("data-name")+"="+$(this).attr("data-sort")),window.location.href="/candle?"+implode("&",t)}))}function formOrder(e){var t,o="cpNumCard",n="cpNameOwner",s="cpMonth",r="cpYear",a="cpCvvCard",i="donate-input",l='input[name="Order[email]"]',c='input[name="Order[cost_donation]"]',d=".pay-agree",u=".agree_mailing",p="#form-order-error-email",m="#form-order-submit",h=".cart-block",f=".order-registration-dashboard",g=".choice-donate-list .donate",v=".choice-donate-list .donate-input",y=".order-container-note",k=".order-close",w=".statistic-line",C=".total-price-area span",N=".order-add-candle-in-cart",b=".notes-area",M=".pc-area-btn-rec",I=".rec-btn",S=".recurrent-checkbox",T=".show-tip",F=".card-data-block",_="#cart-tip",O=".btn-card-data-delete",D="#modal-remove-card",R=".button_yes",L=".button_no",B=".btn-add-new-card",x=".list-card",E=".btn-cancel-add-card",A="#error-choice-card",P=".justify-content-between",j="#apple-pay",H="#google-pay",U="#sbp-pay",q="#bank-list",J=".bank-list-close",G="#bank-list .bank-list-previous",z="#bank-list .bank-list-previous-title",K="#bank-list .bank-list-all",Y=".header_total_price span",V=".header__cartIconNum",Q="list-card-button-pay",W="add-new-card",Z="card__field--error",X="card__field--success",ee="Walter White",te=document.getElementById(o),oe=document.getElementById(n),ne=document.getElementById(s),se=document.getElementById(r),re=document.getElementById(a),ae="",ie=$(l),le=$(p),ce=0,de=[18,5,1,1,2],ue=(new Date).getFullYear(),pe=((new Date).getMonth(),(""+ue).split("").splice(2).join(""),new IMask(te,{mask:"0000 0000 0000 0000000"}),new IMask(oe,{mask:"string*string2",definitions:{"*":/\s/},blocks:{string:{mask:/^[a-zA-Z]+$/},string2:{mask:/^[a-zA-Z]+$/}}}),new IMask(ne,{mask:"00"}),new IMask(se,{mask:"00"}),document.getElementById(i)),me=(new IMask(pe,{mask:Number}),["CARD","TOKENIZED_CARD"]),he=["MASTERCARD","VISA"],fe={tokenizationType:"PAYMENT_GATEWAY",parameters:{gateway:"cloudpayments",gatewayMerchantId:cpPublicId}},ge=0;function ve(){return new google.payments.api.PaymentsClient({environment:"PRODUCTION"})}function $e(){totalPrice=parseInt(generalPrice)+parseInt(ce),$(C).html(totalPrice+" <p>₽</p>"),$(Y).html(totalPrice+" ₽")}function ye(){$(V).html(generalCount)}function ke(){var t,o=!1;return""!=ie.val()?(ie.val(ie.val().trim()),0==ie.val().search(patternEmail)?o=!0:t="Значение «Email» не является правильным email адресом."):t="Необходимо заполнить «Email».",o?(le.text(""),le.hide(),le.parents(settings.selectorInputContner).removeClass(settings.classErrorBlock)):(le.text(t),le.show(),le.parents(settings.selectorInputContner).addClass(settings.classErrorBlock),$(window).scrollTop($(e).offset().top).scrollLeft($(e).offset().left)),o}function we(e,t,o){var n=$('meta[name="csrf-token"]').attr("content"),s=$(settings.selectorFormOrder).serialize(),r=$(u).is(":checked")?"yes":"no";if(!["sbp_l","sbp_i"].includes(e)){var a=[];$(".recurrent-checkbox:checked").each((function(e){a.push($(this).attr("name")+"="+$(this).val())})),a.length>0&&(s=s+"&"+implode("&",a))}switch(s=(s=s+"&pay_type="+t)+"&_csrf="+n+"&Order[agree_mailing]="+r+"&method="+e,e){case"cryptogram":$('input[name="save_card"]').is(":checked")&&(s+="&Order[save_card]=yes"),s=s+"&cp_cryptogram="+o.packet+"&cp_name="+ae;break;case"token":s=s+"&card_id="+o.card_id;break;case"sbp_l":case"sbp_i":break;default:showModalInfo("Не выбран метод оплаты!","Выберите метод оплаты")}$(m).prop("disabled","disabled"),$.ajax({url:"/cart/cp_order",data:s,method:"post",async:!1,success:function(t){var o=JSON.parse(t);if(o.Success)"sbp_l"==e&&o.Model&&o.Model.QrUrl?($.getJSON("https://qr.nspk.ru/proxyapp/c2bmembers.json",(function(e){var t=!1;null!=e.dictionary&&(t=Ie(e.dictionary,o.Model.QrUrl)),!t&&o.Model.Banks&&o.Model.Banks.dictionary&&Ie(o.Model.Banks.dictionary,o.Model.QrUrl)})),ge=o.Model.MerchantOrderId):"sbp_i"==e&&o.Model&&o.Model.QrImage?(o.Model.Amount&&$("#modal-qr").find(".qr-code-price").html("к оплате: <strong>"+o.Model.Amount+" рублей</strong>"),$("#modal-qr").find(".free-note-area").html('<img src="data:image/png;base64,'+o.Model.QrImage+'">'),$("#modal-qr").modal({fadeDuration:250}),ge=o.Model.MerchantOrderId,Se()):"sbp_l"==e||"sbp_i"==e?showModalInfo("Не удалось оплатить!","Проблема с Системой Быстрых Платежей. Попробуйте другой способ оплаты."):window.location.href=o.success_url;else if(o.acs_form){$("#cpPaymentForm").after(o.acs_form)}else showModalInfo("Не удалось оплатить!",o.Message);$(m).prop("disabled",!1)}})}window.onGooglePayLoaded=function(){ve().isReadyToPay({allowedPaymentMethods:me}).then((function(e){e.result&&($(P).show(),$(H).show())}))},showGooglePay&&window.onGooglePayLoaded(),$(window).click((function(e){$(e.target).closest(q).length||$(q).hide()}));function Ce(e){e.classList[e.value.length<=2?"add":"remove"](Z),e.setAttribute("data-valid",[e.value.length<=2?0:1]),e.classList[e.value.length<=2?"remove":"add"](X)}function Ne(e,t){4==t.getAttribute("data-number")?Ce(t):(t.setAttribute("data-valid",[e?0:1]),t.classList[e?"add":"remove"](Z),t.classList[e?"remove":"add"](X))}function be(e){var t=e.target,o=e.target.getAttribute("data-number");t.value=t.value.replace(/\D/g,""),2==o?se.value<22&&se.value.length>0||0===t.value.length||+t.value<=0||+t.value>12?Ne(!0,t):Ne(!1,t):3==o?+t.value<22?(Ne(!0,t),ne.value.length>0&&Ne(!0,ne)):+t.value>=22&&(Ne(!1,t),ne.value.length>0&&+ne.value<13&&Ne(!1,ne)):4==o&&Ce(t)}function Me(e){var t=e.target,o=t.getAttribute("data-number");0==o?t.value.length<=de[o]?Ne(!0,t):Ne(!1,t):1==o&&(t.value.length>1?Ne(!1,t):Ne(!0,t))}function Ie(e,t){var o,n=new cookieList("bank_previous").items();for(var s in 0==n.length?$(z).hide():$(z).show(),$(K).empty(),$(G).empty(),e){if(null==e[s].schema)break;o='<a href= "'+t.replace("https",e[s].schema)+'" data-schema="'+e[s].schema+'"><img src="'+e[s].logoURL+'">'+e[s].bankName+"</a>",$(K).append(o),n.includes(e[s].schema)&&$(G).append(o)}return $(q).show(),""!=$(K).html()}function Se(){var e=setInterval((function(){$.ajax({type:"POST",dataType:"json",url:"/cart/check_order",data:"order_id="+ge,success:function(t){"paid"===t.success||"fail"===t.success?(clearInterval(e),window.location.href=window.location.protocol+"//"+window.location.hostname+t.url):"error"===t.success&&(clearInterval(e),$(q).hide(),showModalInfo("Не удалось оплатить!",t.message))}})}),3e3)}$(document).on("click",m,(function(e){var t,o,s;(e.preventDefault(),ke())&&(t=0,o=0,s={event:"autoEvent",eventCategory:"Cart",eventAction:"PayButtonClick"},$(y+"[data-autofill-quantity][data-quantity]").each((function(){t+=parseInt($(this).attr("data-quantity")),o+=parseInt($(this).attr("data-autofill-quantity"))})),t>0&&(s.TotalNamesCount=t,s.DynamicNamesCount=o),window.dataLayer=window.dataLayer||[],dataLayer.push(s),$("."+Q).is(":visible")?$(F+"."+settings.classActive).length?we("token","card",{card_id:$(F+"."+settings.classActive).attr("data-id")}):$(A).show():(ae=ee,$("#"+n).val(ae),function(e){var t=e.createCryptogramPacket();if(t.success)we("cryptogram","card",t);else{var o=$("#cpPaymentForm");for(var n in o.find(".card__field").removeClass(Z),t.messages)o.find('[data-cp="'+n+'"]').removeClass(X).addClass(Z)}}(new cp.Checkout(cpPublicId,document.getElementById("cpPaymentForm")))))})),$(g).on("click",(function(e){e.preventDefault(),ce=$(this).attr("data-donation-cost"),$(c).val(ce),$(g).removeClass("active"),$(this).addClass("active"),$(v).val(""),$e()})),$(v).on("input",(function(e){ce=parseInt($(this).val()),(isNaN(ce)||ce<0)&&(ce=0),$(c).val(ce),$(g).removeClass("active"),$e()})),$(v).on("click",(function(e){$(this).trigger("input")})),$(d).on("click",(function(e){$(this).is(":checked")?$(m).prop("disabled",!1):$(m).prop("disabled","disabled")})),$(document).on("click",k,(function(e){e.preventDefault();var t=$(this),o=t.attr("data-cart-note-id"),n=t.parents(y);$.ajax({url:"/cart/delete_note",data:{cart_note_id:o},method:"get",async:!1,success:function(e){var t=JSON.parse(e);if("ERROR"==t.result&&alert(t.error),"OK"==t.result){window.dataLayer=window.dataLayer||[],dataLayer.push({ecommerce:{currencyCode:"RUB",remove:{products:[{name:n.attr("data-name"),id:"ID"+n.attr("data-id"),price:n.attr("data-price"),brand:n.attr("data-brand"),category:n.attr("data-category"),variant:n.attr("data-variant"),list_position:n.attr("data-position"),quantity:n.attr("data-quantity")}]}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Removing a Product from a Shopping Cart","gtm-ee-eventnon-interaction":"False"});var o=$(w+'[data-section="'+n.attr("data-type-note-section")+'"]'),s=o.find("span").html()-n.attr("data-quantity");o.find("span").html(s),0==s&&o.hide(),n.remove(),generalPrice=t.data.general_price,generalCount=t.data.general_count,0==generalCount&&($(f).html("<p>Корзина пуста.</p>"),$(h).remove()),$e(),ye()}}})})),$(document).on("click",M+" "+I,(function(e){$(this).hasClass(settings.classActive)?($(this).removeClass(settings.classActive),$(this).parents(M).find(S).prop("checked",!1)):($(this).addClass(settings.classActive),$(this).parents(M).find(S).prop("checked",!0))})),$(document).on("click",M+" "+T,(function(e){e.preventDefault(),Popper.createPopper(this,document.querySelector(_),{placement:"bottom"}),$(_).show()})),$(N).on("click",(function(e){e.preventDefault();var t=$(this).attr("note_id");$.ajax({url:"/cart/add_candle",data:"note_id="+t,method:"get",async:!1,success:function(e){var t=JSON.parse(e);if("ERROR"==t.result&&alert("ERROR"),"OK"==t.result){showModalInfo("Свеча добавлена в корзину!",t.note_title),$(b).append(t.html),generalPrice=t.data.general_price,generalCount=t.data.general_count,$e(),ye();var o=$(w+'[data-section="candle"]'),n=parseInt(o.find("span").html())+1;o.find("span").html(n),o.show(),null!=t.gtm&&null!=t.gtm.notes_list&&(window.dataLayer=window.dataLayer||[],dataLayer.push({ecommerce:{currencyCode:"RUB",add:{products:t.gtm.notes_list}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Adding a Product to a Shopping Cart","gtm-ee-event-non-interaction":"False"})),null!=t.gtm&&null!=t.gtm.ads_value&&null!=t.gtm.ads_items&&dataLayer.push({event:"add_to_cart",value:t.gtm.ads_value,items:t.gtm.ads_items})}}})})),ne.addEventListener("input",(function(e){2==this.value.length&&se.focus()})),se.addEventListener("input",(function(e){2==this.value.length&&re.focus()})),te.addEventListener("blur",Me),oe.addEventListener("blur",Me),ne.addEventListener("input",be),se.addEventListener("input",be),re.addEventListener("input",be),$(F).on("click",(function(e){e.preventDefault(),$(F).removeClass(settings.classActive),$(this).addClass(settings.classActive),$(A).hide()})),$(O).on("click",(function(e){e.preventDefault(),t=$(this).parents(F),$recurrent_cancel=$(this),$(D).modal({fadeDuration:250})})),$(D+" "+R).on("click",(function(e){e.preventDefault();var o=t.attr("data-id");$.ajax({url:"/cart/delete_card",data:{card_id:o},method:"get",async:!1,success:function(e){var o=JSON.parse(e);"ERROR"==o.result&&showModalInfo("Удаление карты!",o.error),"OK"==o.result&&(t.remove(),0==$(F).length&&($(B).trigger("click"),$(E).hide()),showModalInfo("Удаление карты!","Карта удалена"))}})})),$(D+" "+L).on("click",(function(e){$(settings.selectorModal).removeClass(settings.classShowModal).hide()})),$(B).on("click",(function(e){e.preventDefault(),$("."+Q).addClass(W).removeClass(Q),$(x).attr("style","display:none!important"),$(B).hide(),$("#cpPaymentForm").show()})),$(E).on("click",(function(e){e.preventDefault(),$("."+W).addClass(Q).removeClass(W),$(x).show(),$(B).show(),$("#cpPaymentForm").hide()})),$(document).on("click",j,(function(e){if(e.preventDefault(),ke()){var t={countryCode:"RU",currencyCode:"RUB",supportedNetworks:["visa","masterCard"],merchantCapabilities:["supports3DS"],total:{label:"Оплата за записки",amount:parseInt(generalPrice)+parseInt(ce)}},o=new ApplePaySession(1,t);o.onvalidatemerchant=function(e){var t={validationUrl:e.validationURL};$.post("/cart/start_apple_session",t).then((function(e){var t=JSON.parse(e);t.Success?o.completeMerchantValidation(t.Model):showModalInfo("Не удалось запустить сессию!",t.Message)}))},o.onpaymentauthorized=function(e){ae=ee,$('input[name="save_card"]').prop("checked",!1),we("cryptogram","apple",{packet:JSON.stringify(e.payment.token)})},o.begin()}})),$(document).on("click",H,(function(e){if(e.preventDefault(),ke()){var t={merchantId:googleMerchantId,paymentMethodTokenizationParameters:fe,allowedPaymentMethods:me,cardRequirements:{allowedCardNetworks:he}};t.transactionInfo={currencyCode:"RUB",totalPriceStatus:"FINAL",totalPrice:totalPrice},ve().loadPaymentData(t).then((function(e){ae=ee,we("cryptogram","google",{packet:e.paymentMethodToken.token})}))}})),$(document).on("click",U,(function(e){return e.preventDefault(),ke()&&(device.mobile()?we("sbp_l","card"):we("sbp_i","card")),!1})),$(J).on("click",(function(e){$(q).hide()})),$(document).on("click",q+" a",(function(e){return new cookieList("bank_previous").add($(this).attr("data-schema")),Se(),!0}))}function blockLk(e){var t={selectorMonthOrders:e+" .history-note-block",selectorOrder:e+" .order-note",selectorOrderPaidYes:e+" .order-paid-yes",selectorOrderPaidNo:e+" .order-paid-no",selectorDelOrder:e+" .delete-order",selectorOptionOrderPaid:e+" .sett-option-order-paid",selectorShowMoreOrder:e+" .all-note",selectorFavoriteNote:e+" .favorite-note",selectorDelFavoriteNote:e+" .delete-favorite-note",selectorMemorialBlock:e+" .dates-names-block",selectorMemorialList:".content-list",selectorMemorialItem:e+" .content-line",selectorMemorialItemName:" .name",selectorMemorialItemDate:" .date",selectorMemorialItemSend:" .send",selectorMemorialBlockForm:".add-date",selectorMemorialForm:".memorial-form",selectorMemorialFormInputName:'input[name="Memorial[name]"]',selectorMemorialFormInputDate:'input[name="Memorial[date]"]',selectorMemorialFormInputSend:'input[name="Memorial[send]"]',selectorMemorialFormInputId:'input[name="memorial_id"]',selectorMemorialAdd:".memorial-add",selectorMemorialCancel:e+" .memorial-cancel",selectorMemorialEdit:".memorial-edit",selectorMemorialDelete:".memorial-delete",selectorMemorialShowForm:".show-form-memorial",selectorModalRecurrentCancel:"#modal-recurrent-cancel",selectorModalRecurrentButtonYes:".button_yes",selectorModalRecurrentButtonNo:".button_no",selectorRecurrentCancel:".recurrent_cancel",selectorRecurrentRecover:"recurrent_recover",selectorRecurrentCreateRepeat:".note-create-repeat",selectorNoteInfo:".note-info",selectorNoteInfoTitle:".title-desc",selectorNoteInfoNames:".name-str",selectorModalRecurrentCreateData:"#model-recurrent-create-data",selectorModalRecurrentCreateDataDesc:"#model-recurrent-create-data .modal-other-desc p"},o=(new Date).getFullYear();function n(e){if(e)return new IMask(e,{mask:Date,pattern:"MM.DD",blocks:{MM:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},DD:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}},format:function(e){var t=e.getDate(),o=e.getMonth()+1;return t<10&&(t="0"+t),o<10&&(o="0"+o),[t,o].join(".")},parse:function(e){var t=e.split(".");return new Date(o,t[1]-1,t[0])},lazy:!1})}function s(e){e.find(t.selectorMemorialFormInputName).val(""),e.find(t.selectorMemorialFormInputDate).val("__.__"),e.find(t.selectorMemorialFormInputId).val(0),e.find(t.selectorMemorialFormInputSend).prop("checked")||e.find(t.selectorMemorialFormInputSend).trigger("click"),e.find('[type="submit"]').removeAttr("disabled")}n($(t.selectorMemorialFormInputDate)[0]),n($(t.selectorMemorialFormInputDate)[1]);$(t.selectorDelOrder).on("click",(function(e){var o=$(this).attr("order_id"),n=$(this).parents(t.selectorOrder);$.ajax({url:"/user/delete_order",data:{order_id:o},method:"get",async:!1,success:function(e){var t=JSON.parse(e);"ERROR"==t.result&&showModalInfo("Не удалось удалить заказ!",t.error),"OK"==t.result&&("/user/view"==window.location.pathname?window.location.href="/user":n.remove())},error:function(){window.location.href="/site/login"}})})),$(t.selectorDelFavoriteNote).on("click",(function(e){e.preventDefault();var o=$(this).attr("favorite-note-id"),n=$(this).parents(t.selectorFavoriteNote);$.ajax({url:"/user/delete_favorite",data:{favorite_note_id:o},method:"get",async:!1,success:function(e){var t=JSON.parse(e);"ERROR"==t.result&&showModalInfo("Не удалось удалить записку из избранного!",t.error),"OK"==t.result&&n.remove()},error:function(){}})})),$(t.selectorShowMoreOrder).on("click",(function(e){$(t.selectorShowMoreOrder).remove(),$(t.selectorMonthOrders).show()})),$(t.selectorOptionOrderPaid).on("click",(function(e){switch($(this).attr("data-order-paid")){case"all":$(t.selectorOrder).show();break;case"yes":$(t.selectorOrderPaidYes).show(),$(t.selectorOrderPaidNo).hide();break;case"no":$(t.selectorOrderPaidNo).show(),$(t.selectorOrderPaidYes).hide()}})),$(t.selectorMemorialShowForm).on("click",(function(e){$(this).parents(t.selectorMemorialBlock).find(t.selectorMemorialBlockForm).show(),$(this).addClass(settings.classActive)})),$(document).on("submit",t.selectorMemorialForm,(function(e){e.preventDefault()})),$(document).on("click",t.selectorMemorialAdd,(function(e){e.preventDefault();var o=$(this).parents(t.selectorMemorialForm),r=$(this).parents(t.selectorMemorialBlockForm),a=$(this).parents(t.selectorMemorialBlock).find(t.selectorMemorialList);o.find(t.selectorMemorialFormInputId).val();o.find('[type="submit"]').attr({disabled:"disabled"}),$.ajax({url:"/user/create_memorial",data:o.serialize()+"&ajax=true",method:"post",async:!1,success:function(e){var i=JSON.parse(e);if("ERROR"==i.result&&showModalInfo("Добавление даты!",i.error),"OK"==i.result){showModalInfo("Добавление даты!","Дата успешно добавлена.");var l=o.find(t.selectorMemorialFormInputSend).prop("checked")?"yes":"no";$(t.selectorMemorialEdit+'[memorial-id="'+i.id+'"]').parents(t.selectorMemorialItem).remove(),a.append('<div class="content-line"><div class="info"><div class="name">'+o.find(t.selectorMemorialFormInputName).val()+'</div><div class="date">'+o.find(t.selectorMemorialFormInputDate).val()+'</div><div class="send" style="display:none">'+l+'</div></div><div class="btn-area"><button class="memorial-edit" memorial-id="'+i.id+'">редактировать</button><button class="memorial-delete" memorial-id="'+i.id+'">удалить</button></div></div>')}"ERROR_FORM"==i.result&&(r.html(i.html),n($(t.selectorMemorialFormInputDate)[0]),n($(t.selectorMemorialFormInputDate)[1])),s(o)},error:function(){window.location.href="/site/login"}})})),$(document).on("click",t.selectorMemorialCancel,(function(e){e.preventDefault(),block=$(this).parents(t.selectorMemorialBlock),form=$(this).parents(t.selectorMemorialBlockForm),form.hide(),block.find(t.selectorMemorialShowForm).removeClass(settings.classActive),s(form)})),$(document).on("click",t.selectorMemorialEdit,(function(e){e.preventDefault();var o=$(this).attr("memorial-id"),n=$(this).parents(t.selectorMemorialItem).find(t.selectorMemorialItemName).html(),s=$(this).parents(t.selectorMemorialItem).find(t.selectorMemorialItemDate).html(),r=$(this).parents(t.selectorMemorialItem).find(t.selectorMemorialItemSend).html(),a=$(this).parents(t.selectorMemorialBlock).find(t.selectorMemorialBlockForm),i=$(this).parents(t.selectorMemorialBlock).find(t.selectorMemorialForm);i.find(t.selectorMemorialFormInputName).val(n),i.find(t.selectorMemorialFormInputDate).val(s),"yes"!=r||i.find(t.selectorMemorialFormInputSend).prop("checked")||i.find(t.selectorMemorialFormInputSend).trigger("click"),"no"==r&&i.find(t.selectorMemorialFormInputSend).prop("checked")&&i.find(t.selectorMemorialFormInputSend).trigger("click"),i.find(t.selectorMemorialFormInputId).val(o),a.show()})),$(document).on("click",t.selectorMemorialDelete,(function(e){e.preventDefault();var o=$(this).attr("memorial-id"),n=$(this).parents(t.selectorMemorialItem);$.ajax({url:"/user/delete_memorial",data:{memorial_id:o},method:"get",async:!1,success:function(e){var t=JSON.parse(e);"ERROR"==t.result&&showModalInfo("Не удалось удалить дату!",t.error),"OK"==t.result&&n.remove()},error:function(){window.location.href="/site/login"}})})),$(t.selectorRecurrentCancel).on("click",(function(e){e.preventDefault(),$recurrent_cancel=$(this),$(t.selectorModalRecurrentCancel).modal({fadeDuration:250})})),$(t.selectorModalRecurrentCancel+" "+t.selectorModalRecurrentButtonYes).on("click",(function(e){window.location.href=$recurrent_cancel.attr("href")})),$(t.selectorModalRecurrentCancel+" "+t.selectorModalRecurrentButtonNo).on("click",(function(e){$(settings.selectorModal).removeClass(settings.classShowModal).hide()})),$(settings.selectorBlockLk).on("click",t.selectorRecurrentCreateRepeat,(function(e){e.preventDefault(),$noteInfoInOrderRecurrent=$(this).parents(t.selectorNoteInfo);var o=$(settings.selectorBlockLk).attr("order_id"),n=$noteInfoInOrderRecurrent.find(t.selectorNoteInfoTitle).html(),s=$noteInfoInOrderRecurrent.find(t.selectorNoteInfoNames).html(),r=$noteInfoInOrderRecurrent.attr("note_order_id");$.ajax({url:"/user/get_recurrent_create_data",data:{order_id:o,note_order_id:r},method:"get",async:!1,success:function(e){var o=JSON.parse(e);"ERROR"==o.result&&showModalInfo("Ошибка!",o.error),"OK"==o.result&&($(t.selectorModalRecurrentCreateDataDesc).html("Первая оплата записки: "+n+" "+s+"</br> будет произведена "+o.date_start_paid+" и повторяться "+o.label_period_interval),$(t.selectorModalRecurrentCreateData).modal({fadeDuration:250}))},error:function(){return!1}})})),$(t.selectorModalRecurrentCreateData+" "+t.selectorModalRecurrentButtonYes).on("click",(function(e){var o=$(settings.selectorBlockLk).attr("order_id"),n=$noteInfoInOrderRecurrent.attr("note_order_id");$.ajax({url:"/user/recurrent_create",data:{order_id:o,note_order_id:n},method:"get",async:!1,success:function(e){var o=JSON.parse(e);"ERROR"==o.result&&showModalInfo("Ошибка!",o.error),"OK"==o.result&&(showModalInfo("Повтор платежа!","Платеж стал повторяющимся."),$noteInfoInOrderRecurrent.find(t.selectorRecurrentCreateRepeat+" span").html("Повторяется "+o.label_period_interval).addClass(settings.classActive),$noteInfoInOrderRecurrent.find(t.selectorRecurrentCreateRepeat).removeClass("note-create-repeat").addClass(settings.classActive))}})})),$(t.selectorModalRecurrentCreateData+" "+t.selectorModalRecurrentButtonNo).on("click",(function(e){$(t.selectorModalRecurrentCreateData).find(settings.selectorCloseModal).trigger("click")}))}function pushGa(){this.windowHeight=$(window).height(),this.showItemPositionList=this.getDefaultList();var e=this;$("a"+this.sett.selectorNote).on("click",(function(t){var o=!1;return"#"!=$(this).attr("href")&&(e.click($(this)),o=!0),o})),$(this.sett.selectorNote+" a").on("click",(function(t){var o=!1;return"#"!=$(this).attr("href")&&(e.click($(this).parents(e.sett.selectorNote)),o=!0),o}))}$(settings.selectorMenuSpecial+" "+settings.selectorMenuSpecialShowSubmenu).on("click",(function(e){e.preventDefault(),$(this).parents(settings.selectorMenuSpecial).find(settings.selectorMenuSpecialSubmenu).toggle()})),pushGa.prototype={windowHeight:0,showItemPositionList:[],showItemCardId:[],sett:{selectorNoteList:".note-block-info-list",selectorNote:".note-block-info",selectorNoteTitle:".note-block-info-title",selectorNoteGroup:".filter-list-col",selectorNoteCard:".note-block-card-info",selectorNoteCart:".note-block-cart-info",selectorNoteCardExtra:".note-block-info-list-extra"},getDefaultList:function(){var e=[];return $(this.sett.selectorNoteList).each((function(){e[$(this).attr("data-list-id")]=[]})),e},itemInfo:function(e,t=!0){var o={};return void 0!==e&&(o={name:e.attr("data-name"),id:"ID"+e.attr("data-id"),price:parseInt(e.attr("data-price")),brand:e.attr("data-brand"),category:e.attr("data-category"),variant:e.attr("data-variant")},t&&(o.position=e.attr("data-position"))),o},view:function(e){if(e){var t=e.parents(this.sett.selectorNoteList).attr("data-list-id"),o=e.attr("data-position");if(-1==this.showItemPositionList[t].indexOf(o)){this.showItemPositionList[t].push(o);var n=this.itemInfo(e);n.list=e.parents(this.sett.selectorNoteList).attr("data-list"),window.dataLayer=window.dataLayer||[],dataLayer.push({ecommerce:{currencyCode:"RUB",impressions:[n]},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Product Impressions","gtm-ee-event-non-interaction":"True"})}}},click:function(e){if(e){var t=this.itemInfo(e);window.dataLayer=window.dataLayer||[];var o=e.parents(this.sett.selectorNoteList).attr("data-list");null==o&&(o=e.parents(this.sett.selectorNoteCardExtra).attr("data-list")),dataLayer.push({ecommerce:{currencyCode:"RUB",click:{actionField:{list:o},products:[t]}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Product Clicks","gtm-ee-event-non-interaction":"False"})}},checkVisible:function(){var e=this;$(this.sett.selectorNoteList+" "+this.sett.selectorNote).each((function(){var t=$(this).find(e.sett.selectorNoteTitle);if(t.length){var o=t.offset().top+t.height(),n="true"!=$(this).attr("aria-hidden");n&&"true"==$(this).parents(e.sett.selectorNoteGroup).attr("aria-hidden")&&(n=!1),n&&$(this).is(":hidden")&&(n=!1),n&&o>0&&$(document).scrollTop()+e.windowHeight>=o&&t.offset().top>=$(document).scrollTop()&&e.view($(this))}})),$(this.sett.selectorNoteCard).each((function(){var t=$(this).find(e.sett.selectorNoteTitle);if(t.length){var o=t.offset().top+t.height();o>0&&$(document).scrollTop()+e.windowHeight>=o&&t.offset().top>=$(document).scrollTop()&&e.viewCard($(this))}}))},viewCard:function(e){if(e){var t=e.attr("data-id");if(-1==this.showItemCardId.indexOf(t)){this.showItemCardId.push(t);var o=this.itemInfo(e),n=[],s=e.find(this.sett.selectorNoteCardExtra).attr("data-list"),r=this;e.find(this.sett.selectorNoteCardExtra+" "+this.sett.selectorNote+":visible").each((function(){var e=r.itemInfo($(this));e.list=s,n.push(e)})),window.dataLayer=window.dataLayer||[],dataLayer.push({ecommerce:{currencyCode:"RUB",detail:{actionField:{list:e.attr("data-list")},products:[o]},impressions:n},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Product Details","gtm-ee-event-non-interaction":"True"})}}},viewCart:function(){var e=[],t=this;$(this.sett.selectorNoteList+" "+this.sett.selectorNoteCart).each((function(){el=$(this);var o=t.itemInfo(el,!1);o.quantity=Number(el.attr("data-quantity")),e.push(o)})),window.dataLayer=window.dataLayer||[],dataLayer.push({ecommerce:{currencyCode:"RUB",checkout:{actionField:{step:1},products:e}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Checkout Step 1","gtm-ee-event-non-interaction":"False"})}},$(document).ready((function(){if(pGa=new pushGa,setTimeout((function(){pGa.checkVisible()}),1e3),$(document).on("scroll",(function(e){e.preventDefault(),pGa.checkVisible()})),$(pGa.sett.selectorNoteList).on("afterChange",(function(e,t,o){pGa.checkVisible()})),setUtmTags(),$(settings.selectorLoginProfile).on("click","a",(function(e){window.location.href=$(this).attr("href")})),$(settings.selectorShowFilterCandleMob).on("click",(function(e){e.preventDefault(),e.stopPropagation(),$(settings.selectorBlockFilterCandleMob).css({display:"block"}),$(settings.selectorLeftMobileMenuArea).addClass(settings.classOpen)})),$(settings.selectorShowFilterChurchMob).on("click",(function(e){e.preventDefault(),e.stopPropagation(),$(settings.selectorBlockFilterChurchMob).css({display:"block"}),$(settings.selectorLeftMobileMenuArea).addClass(settings.classOpen)})),$(settings.selectorShowFilterHolidayMob).on("click",(function(e){e.preventDefault(),e.stopPropagation(),$(settings.selectorBlockFilterHolidayMob).css({display:"block"}),$(settings.selectorLeftMobileMenuArea).addClass(settings.classOpen)})),$(settings.selectorLoginProfile).on("click",settings.selectorLoginProfileButton,(function(e){e.preventDefault();var t=$(this).parents(settings.selectorLoginProfileForm);$.ajax({url:"/site/login",data:t.serialize()+"&ajax=true",method:"post",async:!1,success:function(e){var t=JSON.parse(e);"ERROR"==t.result&&$(settings.selectorLoginProfile).html(t.html),"OK"==t.result&&(null!=t.url?window.location.href=window.location.protocol+"//"+window.location.hostname+t.url:window.location.reload(!0))}})})),$(settings.selectorLoginProfileMob).on("click",settings.selectorLoginProfileButtonMob,(function(e){e.preventDefault();var t=$(this).parents(settings.selectorLoginProfileFormMob);$.ajax({url:"/site/login_mob",data:t.serialize()+"&ajax=true",method:"post",async:!1,success:function(e){var t=JSON.parse(e);"ERROR"==t.result&&$(settings.selectorLoginProfileMob).html(t.html),"OK"==t.result&&(null!=t.url?window.location.href=window.location.protocol+"//"+window.location.hostname+t.url:window.location.reload(!0))}})})),$("body").on("click",settings.selectorErrorInput,(function(e){$(this).parents(settings.selectorErrorBlock).find(settings.selectorErrorMessage).hide(),$(this).parents(settings.selectorErrorBlock).removeClass(settings.classErrorBlock),$(this).removeClass(settings.classErrorBlock)})),$(settings.selectorLoginForComment).on("click",(function(e){e.preventDefault(),e.stopPropagation(),showLogin();var t=window.innerWidth<=1025?0:700;$("html, body").stop().animate({scrollTop:50},t,"swing")})),$(settings.selectorFormClear).on("click",(function(e){e.preventDefault(),$(this).parents("form").find("input").val(""),$(this).parents("form").find("textarea").val("")})),$(settings.selectorAddCandleInCart).on("click",(function(e){e.preventDefault();var t=$(this).attr("note_id");pGa.click($(this).parents(pGa.sett.selectorNote)),$.ajax({url:"/candle/add_to_cart",data:"note_id="+t,method:"post",async:!1,success:function(e){var t=JSON.parse(e);"ERROR"==t.result&&alert("ERROR"),"OK"==t.result&&(null!=t.gtm&&null!=t.gtm.notes_list&&(window.dataLayer=window.dataLayer||[],dataLayer.push({ecommerce:{currencyCode:"RUB",add:{products:t.gtm.notes_list}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Adding a Product to a Shopping Cart","gtm-ee-event-non-interaction":"False"})),null!=t.gtm&&null!=t.gtm.ads_value&&null!=t.gtm.ads_items&&dataLayer.push({event:"add_to_cart",value:t.gtm.ads_value,items:t.gtm.ads_items}),window.location.href=window.location.protocol+"//"+window.location.hostname+"/cart")}})})),$("body").on("click",settings.selectorSelectOption,(function(e){var t=$(this).parents(settings.selectorSelect);t.find(".select span").html($(this).html()),t.hasClass(settings.classOpen)&&(t.removeClass(settings.classOpen),t.find(".options").slideToggle())})),$("body").on("click",settings.selectorSelectInput,(function(e){e.preventDefault(),e.stopPropagation(),$(settings.selectorSelect).find(".options:visible").slideUp(),$(settings.selectorSelect).removeClass(settings.classOpen),$(this).parents(settings.selectorSelect).find(".options").slideToggle(),$(this).parents(settings.selectorSelect).toggleClass(settings.classOpen)})),$(settings.selectorCloseModal).on("click",(function(e){e.preventDefault(),$(settings.selectorModal).removeClass(settings.classShowModal).hide()})),$(settings.selectorModalAddToCart).on("click",settings.selectorCloseModal,(function(e){e.preventDefault(),$(settings.selectorModalAddToCart).modal("hide"),$(settings.selectorModal).removeClass(settings.classShowModal)})),$(settings.selectorFilterToggle).on("click",(function(e){e.preventDefault(),$(settings.selectorFilter).hasClass(settings.classOpen)?($(settings.selectorFilter).removeClass(settings.classOpen).hide(),$(settings.selectorFilterToggle).html("Развернуть фильтр")):($(settings.selectorFilter).addClass(settings.classOpen).show(),$(settings.selectorFilterToggle).html("Свернуть фильтр"))})),$(settings.selectorBlockSendNote).length){var e=new blockSendNote(settings.selectorBlockSendNote);"/"!==window.location.pathname?e.setNames():$(document).on("scroll",(function(t){t.preventDefault();var o=$(settings.selectorBlockSendNote).offset().top;$(document).scrollTop()+$(window).height()>=o&&(e.setNames(),$(this).off())}))}if($(settings.selectorFilterHoliday).length)new filterHoliday(settings.selectorFilterHoliday);if($(settings.selectorBlockFilterHolidayMob).length)new filterHoliday(settings.selectorBlockFilterHolidayMob);if($(settings.selectorFilterChurch).length)new filterChurch(settings.selectorFilterChurch);if($(settings.selectorBlockFilterChurchMob).length)new filterChurch(settings.selectorBlockFilterChurchMob);if($(settings.selectorBlockFilterCandleMob).length)new filterCandle(settings.selectorBlockFilterCandleMob);if($(settings.selectorBlockFilterCandle).length)new filterCandle(settings.selectorBlockFilterCandle);if($(settings.selectorFormOrder).length){new formOrder(settings.selectorFormOrder);pGa.viewCart()}if($(settings.selectorBlockLk).length)new blockLk(settings.selectorBlockLk);$(settings.selectorMenuSpecial+" "+settings.selectorMenuSpecialShowSubmenu).on("click",(function(e){e.preventDefault(),$(this).parents(settings.selectorMenuSpecialItem).find(settings.selectorMenuSpecialSubmenu).toggle()})),$(settings.selectorChurchShowTip).on("click",(function(e){e.preventDefault();var t=$(this).parents(settings.selectorFilterChurchItem);$(settings.selectorChurchBlockTip).find(settings.selectorBlockTipIcon).attr("src",t.find(settings.selectorFilterChurchItemImg).attr("src")),$(settings.selectorChurchBlockTip).find(settings.selectorBlockTipTitle).html(t.find(settings.selectorFilterChurchItemTitle).html()),$(settings.selectorChurchBlockTip).find(settings.selectorBlockTipText).html(t.find(settings.selectorFilterChurchItemText).html()),Popper.createPopper(this,document.querySelector(settings.selectorChurchBlockTip),{placement:"bottom"}),$(settings.selectorChurchBlockTip).show()})),$(settings.selectorFilterTypeNoteMainShowTip).on("click",(function(e){e.preventDefault();var t=$(this).parents(settings.selectorFilterRow);$(settings.selectorMainTypeNoteBlockTip).find(settings.selectorBlockTipTitle).html(t.find(settings.selectorFilterMainTypeNoteItemTitle).html()),$(settings.selectorMainTypeNoteBlockTip).find(settings.selectorBlockTipText).html(t.find(settings.selectorFilterMainTypeNoteItemText).html()),Popper.createPopper(this,document.querySelector(settings.selectorMainTypeNoteBlockTip),{placement:"bottom"}),$(settings.selectorMainTypeNoteBlockTip).show()}));"undefined"!=typeof sbjs&&-1==["email","cpc"].indexOf(sbjs.get.current.mdm)&&-1==["push","email","unisender"].indexOf(sbjs.get.current.src)&&$(document).mouseleave((function(e){e.clientY<10&&null==$.cookie("alertwin")&&($(settings.selectorModalFreeNote).modal({fadeDuration:250}),$.cookie("alertwin","no",{expires:10,path:"/"}))})),$(document).on("submit",settings.selectorFormFreeNote,(function(e){if(13==event.keyCode)return event.preventDefault(),keydown,!1})),$(document).on("submit",settings.selectorFormFreeNote,(function(e){e.preventDefault();var t=$(settings.selectorFormFreeNote);if(null==$.cookie("_partner_url")){var o,n="";"/"!=window.location.pathname&&(n=window.location.pathname),o=window.location.protocol+"//"+window.location.hostname+n+"?partner=PopUp",$.cookie("_partner_url",o,{expires:15,path:"/"})}t.find('[type="submit"]').attr({disabled:"disabled"}),$.ajax({url:"/cart/free_note",data:t.serialize()+"&ajax=true",method:"post",async:!1,success:function(e){var o=JSON.parse(e);"ERROR"==o.result&&$(settings.selectorFreeNoteText).html(o.error),"OK"==o.result&&$(settings.selectorFreeNoteText).html(o.data),"ERROR_FORM"==o.result&&($(settings.selectorBlockFreeNote).html(o.html),setUtmTags()),t.find('[type="submit"]').attr({disabled:!1})}})})),$(settings.selectorFreeNoteFamilyTypeNote).on("click",(function(e){$(settings.selectorFreeNoteFamilyTypeNote).removeClass(settings.classActive),$(this).addClass(settings.classActive)})),$(document).on("submit",settings.selectorFormFreeNoteFamily,(function(e){e.preventDefault();var t=[];$(settings.selectorFreeNoteFamilyTypeNote+"."+settings.classActive).each((function(e){t.push("Notes["+e+"]="+$(this).attr("note_id"))}));var o=$(settings.selectorFormFreeNoteFamily);if(null==$.cookie("_partner_url")){var n,s="";"/"!=window.location.pathname&&(s=window.location.pathname),n=window.location.protocol+"//"+window.location.hostname+s+"?partner=MolebenFamily",$.cookie("_partner_url",n,{expires:15,path:"/"})}o.find('[type="submit"]').attr({disabled:"disabled"});var r=t.join("&");$.ajax({url:"/cart/free_note_family",data:o.serialize()+"&ajax=true&"+r,method:"post",async:!1,success:function(e){var t=JSON.parse(e);"ERROR"==t.result&&showModalInfo("Ошибка",t.error),"OK"==t.result&&($(settings.selectorModalFreeNoteFamilyShare).modal({fadeDuration:250}),$(settings.selectorBlockFreeNoteFamily).html(t.html)),"ERROR_FORM"==t.result&&$(settings.selectorBlockFreeNoteFamily).html(t.html)}})})),$(settings.selectorPopupTipClose).on("click",(function(e){e.preventDefault(),$(this).parents(settings.selectorPopupTip).hide()})),$(settings.selectorShowModalFreeNoteFamilyThanks).on("click",(function(e){$(settings.selectorModalFreeNoteFamilyThanks).modal({fadeDuration:250})})),$(settings.selectorBlockLoginMob).on("click",(function(e){e.preventDefault(),e.stopPropagation(),showLogin()})),$(settings.selectorFormSubscribe).on("submit",(function(e){return validEmail($(this).find('input[name="email"]'))})),$(settings.selectorFormSubscribeTop).on("submit",(function(e){var t=$(this).find('input[type="email"]'),o=validEmail(t);return o||t.addClass(settings.classErrorBlock),o})),$(settings.selectorHolidayReadMore).on("click",(function(e){e.preventDefault(),$(this).hide(),$(this).parents(settings.selectorHolidayFullText).find(settings.selectorHolidayTextReadMore).show()})),$(settings.selectorNavigationLink).on("click",(function(e){var t=$($(this).attr("href"));if(t.length>0){var o=t.eq(0).offset().top-20;$("html, body").stop().animate({scrollTop:o},900,"swing")}}))}));
